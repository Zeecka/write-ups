# Website

This is the source for <https://www.bitsforeveryone.com>.

This is a static site generated by [Hugo][h] and hosted on [GitHub Pages][g].

[g]:https://pages.github.com/
[h]:https://gohugo.io/

## Table of Contents
- [Quick Start](#quick-start)
  - Get setup and start publishing.
- [Organization and Methodology](#organization)
  - Explains hugo and conventions.
- [Gotchas](#gotchas-and-tips)
  - Check here when things don't work.

## Quick Start

### Via the Web

It is possible to add content completely from the GitHub web interface.

1. Click `Create a new file`
2. Give it a name/path
3. Copy in the metadata from [./archetypes/writeup.md][wa]
4. Add content and commit

However, it is highly recommended that you edit content locally so you can
preview how the entire site will look once published with hugo.

### With Hugo (recommended)

#### Setup
1. [Install Hugo](https://gohugo.io/getting-started/installing/#quick-install)
2. `hugo server --buildDrafts`

Now you have a development copy of the website at <http://localhost:1313/>. As
you edit content it will automatically be updated.

If you plan to [deploy](#publish-to-website) the website you should also (note
it is not required, anyone else can deploy the website once your content is
committed to the repository).

- Ensure you have the git [submodules](#submodules)

#### Create a Writeup

```
hugo new writeup/exampleCTF/pwnable.md
```

This will create a file `content/writeup/exampleCTF/pwnable.md` (including
directories), that has a starter [template][tt] for a writeup.

*Note: there is nothing magic about this command.* The file could also have been
created manually. The command is just a convenience to ensures the file has all
the necessary metadata and provides a consistent template.

By default the writeup will be marked as a `draft`. This will allow you to edit
the file, view it locally, commit and share, get feedback all without the
writeup being published to the website. Once a post is ready just remove this
line from the frontmatter.

#### Create a CTF

```
hugo new --kind ctf writeup/exampleCTF/_index.md
```

Edit the created file to set the name.

This will show above the list of writeups for that CTF. This could be used to
put information like who participated, how we placed, etc. Typically should be
short ~1-2 paragraphs. This will also create a menu entry in the navbar. The
same draft rules apply as above.

#### Publish to Website

`./deploy.sh`

This will run the following steps.

1. Build the site (`hugo`)
2. Commit the new version to the `public` repository (git submodule)
3. Push the new version to Github (bitsforeveryone.github.io)
4. Update this repository with the deployment information

*Note: in order for step 3 to be successful the user running the script must have
permissions on the remote repository.*

## Organization

You can find out more about the organization of a hugo site in the
[documentation][dir]. I will highlight a few files and directories:

[dir]:https://gohugo.io/getting-started/directory-structure/

```
.
├── config.toml 
├── content
│   ├── page
│   │   └── about.md
│   ├── project
│   │   └── grapefruit.md
│   └── writeup
│       ├── csaw_2017
│       │   ├── _index.md
│       │   └── tableEZ.md
│       └── _index.md
├── public
├── static
└── themes
```

[`config.toml`](./config.toml) sets up metadata for the website such as it's
`baseurl` and `title`.  The primary reason you might edit this file it to add a
section to the navigation `menu`. [Additional documentation][conf].

[conf]:https://gohugo.io/getting-started/configuration/

[`content`](./content) contains the actual source of the website pages organized
into sub directories called `sections`. In the above example  [`page`][page],
[`project`][proj], and [`writeup`][w] are all sections. [Additional
documentation][cont].

[page]:./content/page
[proj]:./content/project
[w]:./content/writeup
[cont]:https://gohugo.io/getting-started/directory-structure/

The source for each page on the website is just a plain [Markdown][md] file with
some [`frontmatter`][front] that provides metadata for the page such as `title`,
`type`, and `tags`. In the above example `about.md`, `grapefruit.md`, and
`tableEZ.md` are all pages. Hugo is configured so that it will nicely aggregate
all the pages in a section on a page. So when you visit
<https://bitsforeveryone.com/writeup/> you will see all the pages from that
section. *Note, in order to use nested directories for each CTF each post must
be set as `type: "writeup"`*, however this is easily handled with
[templates][tt].  There is a special type of page named `_index.md` which can be
used to add information at the beginning of a section list page.


[md]:https://github.com/adam-p/markdown-here/wiki/Markdown-Cheatsheet
[front]:https://gohugo.io/content-management/front-matter#readout
[tt]:#templates

`public` is the static site generated by running `hugo`. This is what is
served by GitHub.  **This should not be manually edited**. This directory is
actually a [git submodule][gsm] that refers to the
[bitsforeveryone/bitsforeveryone.github.io][io] repository. This is required by
GitHub pages. [Additional documentation][ghp]. This directory is automatically
updated, committed, and pushed with the `deploy.sh` [script](#publish-to-website).

[io]:https://github.com/bitsforeveryone/bitsforeveryone.github.io
[ghp]:https://gohugo.io/hosting-and-deployment/hosting-on-github/#host-github-user-or-organization-pages
[gsm]:https://git-scm.com/book/en/v2/Git-Tools-Submodules

[`static`](./static) contains custom images such as the logo.  Write up specific
files and images can be committed in a higher level directory. See the [images
section](#images) for more in

[`themes`](./themes) contains the [Beautiful Hugo][bh].  This is what determines
the look and feel of the website. Portions of this can be overridden in folders
like `archetypes`, and `layouts` to customize the site.  The theme can be easily
changed but might require some additional work to ensure the nested directories
work correctly.

[bh]:https://github.com/halogenica/beautifulhugo

## Gotchas and Tips

#### Submodules

This repository has git submodules  in order to publish the site. Here is how to
get setup:

- If you have not yet checked out the repository:
  - `git clone --recursive git@github.com:bitsforeveryone/write-ups.git`
  - note the `--recursive`
- If you already have the repository:
  - `git submodule init`
  - `git submodule update --recursive`

**Change: we used to use submodules for the theme as well, but that has since
been removed due to unessecary complexity. Now we vendor the source code of the
theme directly**

#### Templates

Hugo has a notion of an [archetype][a] which is essentially a preconfigured
template file. This is used by the `hugo new` commands to easily generate
content.  For example when you run:

```
hugo new writeup/exampleCTF/pwn.md
```
it will use the archetype based on the section (`writeup`) from
[`./archetype/writeup.md`][wa]. You can also use `--kind` to explicitly pick
which archetypes is used (as shown in the `ctf` [section](#create-a-ctf)).

[arch]:https://gohugo.io/content-management/archetypes/
[wa]:./archetypes/writeup.md

#### Images
If your images do not show up, and all you see is the `alt text` in thier place,
this is likely because it is referencing the Github page rather than the raw
content. All you have to do is replace `blob` with `raw` in the url. For
example:

Correct:
```
 ![Image of Scoreboard](https://github.com/bitsforeveryone/write-ups/raw/master/CSAW_CTF_2017/scoreboard.png)
```

Broken:
```
 ![Image of Scoreboard](https://github.com/bitsforeveryone/write-ups/blob/master/CSAW_CTF_2017/scoreboard.png)
```

To fix in vim: `%s/blob/raw/gc`
